<!-- base.htmlを継承する -->
{% extends 'NagoyameshiApp/user/base.html' %}

<!-- ページタイトル -->
{% block title %}店舗一覧|Nagoyameshi{% endblock %}

<!-- コンテンツ本体 -->
{% block content %}
{% load static %}

  <div class="container">
    <!-- 備忘録）カラム使用時にrow忘れない -->
  <div class="row">

    <!-- パンくずリスト -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'top' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'restaurant_list' %}">店舗一覧</a></li>
      </ol>
    </nav>

    <!-- 左側のカラム（検索窓） -->
    <div class="col-xl-3 col-lg-4 col-md-12 list_search_all">
      <div class="list_search">
        <div class="fs-6 list_search_item">
          <span>検索</span>
        </div>
        <form method="GET" action="{% url 'restaurant_list' %}">
          <p>キーワード</p>
          <input type="text" name="keyword" placeholder="店舗名・エリアなど" class="form-control list_search_box" value="{{ request.GET.keyword }}">
          <p>ジャンル</p>
          <select name="genre" class="form-control list_search_box">
            <option value="">選択してください</option>
            <option value="和食" {% if request.GET.genre == '和食' %} selected {% endif %}>和食</option>
            <option value="洋食" {% if request.GET.genre == '洋食' %} selected {% endif %}>洋食</option>
            <option value="中華" {% if request.GET.genre == '中華' %} selected {% endif %}>中華</option>
            <option value="フレンチ" {% if request.GET.genre == 'フレンチ' %} selected {% endif %}>フレンチ</option>
            <option value="イタリアン" {% if request.GET.genre == 'イタリアン' %} selected {% endif %}>イタリアン</option>
            <option value="名古屋コーチン" {% if request.GET.genre == '名古屋コーチン' %} selected {% endif %}>名古屋コーチン</option>
            <option value="味噌カツ" {% if request.GET.genre == '味噌カツ' %} selected {% endif %}>味噌カツ</option>
            <option value="うなぎ" {% if request.GET.genre == 'うなぎ' %} selected {% endif %}>うなぎ</option>
            <option value="おでん" {% if request.GET.genre == 'おでん' %} selected {% endif %}>おでん</option>
            <option value="焼き鳥" {% if request.GET.genre == '焼き鳥' %} selected {% endif %}>焼き鳥</option>
            <option value="うどん・そば" {% if request.GET.genre == 'うどん・そば' %} selected {% endif %}>うどん・そば</option>
            <option value="きしめん" {% if request.GET.genre == 'きしめん' %} selected {% endif %}>きしめん</option>
            <option value="焼肉" {% if request.GET.genre == '焼肉' %} selected {% endif %}>焼肉</option>
            <option value="ハンバーガー" {% if request.GET.genre == 'ハンバーガー' %} selected {% endif %}>ハンバーガー</option>
          </select>
          <p>価格帯</p>
          <select name="list_price_min" class="form-control list_search_box_price">
            <option value="">最小</option>
            <option value="1000" {% if request.GET.list_price_min == '1000' %} selected {% endif %}>1,000 円</option>
            <option value="2000" {% if request.GET.list_price_min == '2000' %} selected {% endif %}>2,000 円</option>
            <option value="3000" {% if request.GET.list_price_min == '3000' %} selected {% endif %}>3,000 円</option>
            <option value="4000" {% if request.GET.list_price_min == '4000' %} selected {% endif %}>4,000 円</option>
            <option value="5000" {% if request.GET.list_price_min == '5000' %} selected {% endif %}>5,000 円</option>
            <option value="6000" {% if request.GET.list_price_min == '6000' %} selected {% endif %}>6,000 円</option>
            <option value="8000" {% if request.GET.list_price_min == '8000' %} selected {% endif %}>8,000 円</option>
            <option value="10000" {% if request.GET.list_price_min == '10000' %} selected {% endif %}>10,000 円</option>
            <option value="15000" {% if request.GET.list_price_min == '15000' %} selected {% endif %}>15,000 円</option>
            <option value="20000" {% if request.GET.list_price_min == '20000' %} selected {% endif %}>20,000 円</option>
            <option value="30000" {% if request.GET.list_price_min == '30000' %} selected {% endif %}>30,000 円</option>
          </select>
          <p class="list_search_box_price"> 〜 </p>
          <select name="list_price_max" class="form-control list_search_box_price">
            <option value="">最大</option>
            <option value="1000" {% if request.GET.list_price_max == '1000' %} selected {% endif %}>1,000 円</option>
            <option value="2000" {% if request.GET.list_price_max == '2000' %} selected {% endif %}>2,000 円</option>
            <option value="3000" {% if request.GET.list_price_max == '3000' %} selected {% endif %}>3,000 円</option>
            <option value="4000" {% if request.GET.list_price_max == '4000' %} selected {% endif %}>4,000 円</option>
            <option value="5000" {% if request.GET.list_price_max == '5000' %} selected {% endif %}>5,000 円</option>
            <option value="6000" {% if request.GET.list_price_max == '6000' %} selected {% endif %}>6,000 円</option>
            <option value="8000" {% if request.GET.list_price_max == '8000' %} selected {% endif %}>8,000 円</option>
            <option value="10000" {% if request.GET.list_price_max == '10000' %} selected {% endif %}>10,000 円</option>
            <option value="15000" {% if request.GET.list_price_max == '15000' %} selected {% endif %}>15,000 円</option>
            <option value="20000" {% if request.GET.list_price_max == '20000' %} selected {% endif %}>20,000 円</option>
            <option value="30000" {% if request.GET.list_price_max == '30000' %} selected {% endif %}>30,000 円</option>
          </select>
          <button type="submit" class="btn search_btn list_search_item">検索</button>
        </form>
      </div>
    </div>
    
    <!-- 右側のカラム -->
    <div class="col list_right_column d-flex flex-column align-items-center">
      <!-- 上部 -->
      <div class="d-flex justify-content-between align-items-center mb-3 w-100">
        <!-- 検索された店舗数 -->
        <div class="hit_restaurants_number">
          <span>{{ restaurants.paginator.count }}</span>店舗（{{ restaurants.start_index }}〜{{ restaurants.end_index }}件）
        </div>

        <!-- 並び替え -->
        <div>
          <form id="sort-form" method="GET" action="{% url 'restaurant_list' %}">
            <div class="select-wrapper">
              <select id="sort-select" name="sort" class="form-control" onchange="this.form.submit()">
                <option value="掲載日が新しい順" {% if sort_option == "掲載日が新しい順" %}selected{% endif %}>掲載日が新しい順　</option>
                <option value="価格が安い順" {% if sort_option == "価格が安い順" %}selected{% endif %}>価格が安い順　</option>
                <option value="価格が高い順" {% if sort_option == "価格が高い順" %}selected{% endif %}>価格が高い順　</option>
                <option value="予約数順" {% if sort_option == "予約数順" %}selected{% endif %}>予約数順　</option>
              </select>
              <span class="select-arrow">▽</span>
            </div>
          </form>
        </div>
      </div>

      <!-- 店舗カード -->
      <div class="mb-3">
        {% for restaurant in restaurants %}
        <a href="{% url 'restaurant_detail' restaurant.pk %}">
        <div class="card mb-3" style="max-width: 540px;">
          <div class="row g-0">
            <div class="col-md-4">
              <img src="{{ restaurant.img.url }}" class="img-fluid rounded-start" alt="{{ restaurant.name }}">
            </div>
            <div class="col-md-8">
              <div class="card-body">
                <h5 class="card-title">{{ restaurant.name }}</h5>
                <p class="card-text">{{ restaurant.catch_copy }}</p>
                <p class="card-text"><small class="text-body-secondary">{{ restaurant.category }}</small></p>
                <p class="card-text"><small class="text-body-secondary">&#9733; {{ restaurant.get_average.0 }}（{{ restaurant.get_average.1 }}件）</small></p>
              </div>
            </div>
          </div>
        </div>
        </a>
        {% endfor %}  

      </div>

      <!-- ページネーション -->
      <nav aria-label="Page navigation example w-100">
        <ul class="pagination">
            {% if restaurants.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% endif %}
            {% for num in restaurants.paginator.page_range %}
            <li class="page-item {% if num == restaurants.number %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
            {% endfor %}
            {% if restaurants.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ restaurants.paginator.num_pages }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            {% endif %}
        </ul>
      </nav>


    </div>
  </div>
  </div>

<script src="{% static 'js/script_restaurant_list.js' %}"></script>

{% endblock content %}
